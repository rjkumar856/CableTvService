var customNav=function(){var e={selectorID:".customNav",megaMenuDropdown:".mega-dropdown-menu",megaMenuLinkClass:".mega-menu-link",megaMenuLinkHoverClass:"menu-active",megaMenuOpenClass:"mega-menu-open",megaMenuCommonClass:".mega-menu-container",megaMenuDataAttr:"data-mega-menu",megaMenuCrossClass:".mega-menu-close",mobileMenuTriggerClass:".mobile-nav-trigger",mobileMenuClass:"header .navbar-default",mobileOpenClass:"open-mobilemenu",mobileMenuBodyClass:"mobile-modal-open",linkActiveClass:"link-active"};return{initMenu:function(){function t(){var t=$(e.mobileMenuClass);t.toggleClass(e.mobileOpenClass),t.hasClass("open-mobilemenu")?($("body").addClass(e.mobileMenuBodyClass),history.pushState({},"menu")):($("body").removeClass(e.mobileMenuBodyClass),o.removeClass(e.megaMenuOpenClass),history.replaceState({},"back"))}var a=$(e.megaMenuLinkClass),o=$(e.megaMenuCommonClass);a.off("click").on("click",function(t){history.pushState({},"menu2"),t.preventDefault();var r=$(this),n=r.hasClass(e.megaMenuLinkHoverClass);a.removeClass(e.megaMenuLinkHoverClass,!1),n?r.addClass(e.megaMenuLinkHoverClass):r.removeClass(e.megaMenuLinkHoverClass),r.toggleClass(e.megaMenuLinkHoverClass);var i=r.attr(e.megaMenuDataAttr);o.removeClass(e.megaMenuOpenClass);var l=".mega-menu-"+i,s=$(l);n?s.addClass(e.megaMenuOpenClass):s.removeClass(e.megaMenuOpenClass),s.toggleClass(e.megaMenuOpenClass);var c=$(e.megaMenuCrossClass);c.off("click").on("click",function(){history.replaceState({},"back",window.location.pathname.replace("/menuOpened","")),s.removeClass(e.megaMenuOpenClass),r.removeClass(e.megaMenuLinkHoverClass)}),$("body").on("keyup",function(e){27==e.which&&c.trigger("click")});var u=$(e.megaMenuDropdown),m=$(e.megaMenuDropdown).find("li");m.removeClass(e.linkActiveClass),u.each(function(){var t=$(this).find("ul > li:not(:first-child)"),a=$(this).children("ul").children("li");a.eq(1).addClass(e.linkActiveClass),t.find("a").on("mouseover",function(){var t=$(this).closest("ul").children();t.removeClass(e.linkActiveClass),$(this).parent("li").children("ul").length>0&&$(this).parent("li").addClass(e.linkActiveClass)})})});$(e.mobileMenuTriggerClass);backButton.init(),$("body").removeClass(e.mobileMenuBodyClass),$(document).off("click").on("click",e.mobileMenuTriggerClass,function(){t()})},megaMenuDropdown:function(){}}}(),footerBackToTop=function(){var e={duration:3e3,toPosition:0,triggerElement:".scroll-to-top"};return{init:function(){"undefined"==typeof angular&&$(e.triggerElement).on("click",function(){footerBackToTop.scrollTo($(e.triggerElement))})},scrollTo:function(e){var t=e.offset().top,a=setInterval(function(){t-=parseInt(t/10)+1,window.scrollTo(0,t),t<=0&&clearInterval(a)},t>500?3e4/t:1e5/t)}}}(),smallHeaderScroll=function(){var e={duration:300,selector:"header",overlaySelector:"select-city.overlay",headerDifference:40};return{init:function(){window.addEventListener("scroll",function(t){var a=window.pageYOffset||document.documentElement.scrollTop,o=e.duration,r=$(e.selector);overlay=$(e.overlaySelector),a>o?(r.addClass("header-small"),overlay.addClass("overlay-adjusted")):a+e.headerDifference<o&&r.hasClass("header-small")&&(r.removeClass("header-small"),overlay.removeClass("overlay-adjusted"))})}}}(),loadAsyncImages=function(){var e={selector:"body img"};return{init:function(){for(var t=$(e.selector),a=0;a<t.length;a++){var o=t[a].getAttribute("data-src");o&&t[a].setAttribute("src",o)}}}}(),scrollInView=function(){var e={selector:".airtelwow",classToAdd:"animated"};return{init:function(){var t=$(e.selector),a=$("body");$(document).on("scroll",function(){var o=distanceY=window.pageYOffset||document.documentElement.scrollTop,r=a.height(),n=o,i=n+r;t.each(function(){var t=$(this),a=t.outerHeight(),o=t.offset().top+50,r=o+a;r>=n&&o<=i&&t.addClass(e.classToAdd)})}),setTimeout(function(){a.trigger("scroll")},1e3)}}}(),boxLink=function(){var e={selector:".bggray_hover"};return{init:function(){var t=$(e.selector);t.on("click",function(e){e.stopPropagation(),e.preventDefault();var t=$(this).find("a.link");t.each(function(){$this=$(this),"none"!=$this.css("display")&&(aTagVisible=$this)}),aTagVisible.length>0&&("_blank"==aTagVisible[0].target?window.open(aTagVisible.attr("href"),"_blank"):window.open(aTagVisible.attr("href"),"_self"))})}}}(),backButton=function(){return{init:function(){if("function"==typeof history.pushState)window.onpopstate=function(){$(".mega-menu-open")&&$(".mega-menu-open").length?($(".mega-menu-container").removeClass("mega-menu-open"),$(".mega-menu-link").removeClass("menu-active")):$("#customNav").hasClass("open-mobilemenu")&&$(".mobile-nav-trigger").trigger("click")};else{var e=!0;window.onhashchange=function(){e?e=!1:(e=!0,window.location.hash=Math.random())}}},closePopup:function(){}}}(),loadHtml=function(){return{init:function(e,t){var a=new XMLHttpRequest;a.open("GET",e,!0),a.onreadystatechange=function(){if(4===this.readyState&&200===this.status){var e=$("#"+t);e.length&&($(e)[0].innerHTML=this.responseText)}},a.send()}}}(),isLocalStorageSupported=function(){return{init:function(){var e="test",t=window.localStorage;try{return t.setItem(e,"1"),t.removeItem(e),!0}catch(e){return!1}}}}(),loadCart=function(){return{init:function(){if(isLocalStorageSupported.init())var e=localStorage.getItem("homeCartCount");else var e=getFromCookie.init("homeCartCount");e?($(".home-cart").removeClass("hide-home"),$(".home-cart .cart_count").html(e)):$(".home-cart").addClass("hide-home")}}}(),getFromCookie=function(){return{init:function(e){for(var t=e+"=",a=document.cookie.split(";"),o=0;o<a.length;o++){for(var r=a[o];" "==r.charAt(0);)r=r.substring(1);if(0==r.indexOf(t))return r.substring(t.length,r.length)}return""}}}();"undefined"!=typeof angular&&"undefined"!=typeof define?define(["angular"],function(e){e.module("airtel").controller("appHeaderCtrl",["$rootScope","appAnalyticsUtils","$state","appUtils","$timeout","$notification","appService","airtelModal","$scope","$location",function(e,t,a,o,r,n,i,l,s,c){"use strict";function u(){o.removeFromLocalStorage("header","CartDetail"),e.cartDetail&&e.cartDetail.orderItems&&(e.cartDetail.orderItems=[],e.cartDetail.orderItems.length=0,e.cartDetail=null),e.isOpenCart=!1,e.isShowCart=!1,localStorage.removeItem("homeCartCount"),e.cartCount=0}function m(){if(e.cartDetail&&e.cartDetail.orderItems&&e.cartDetail.orderItems.length>0)for(var t=0;t<e.cartDetail.orderItems.length;t++)o.checkZeroLoanProduct(e.cartDetail.orderItems[t].id.toString())?e.cartDetail.orderItems[t].type=!0:e.cartDetail.orderItems[t].type=!1}function d(){if(e.isShowCart=!1,isLocalStorageSupported.init())var t=localStorage.getItem("homeCartCount");else var t=o.getFromCookie("homeCartCount");c.$$search.cartOpen&&t&&C.openCart(),C.getCartInfoLocal(),m()}var C=this;C.isMobile=o.isMobileWidth(),C.analyticsUtil=t.triggerTrackingCode,C.openCart=function(){0==e.cartCount?a.go("main.app.devices.plp",{viewAllDevices:!0}):(e.isOpenCart=!0,$("body").addClass("modal-open"))},$(document).keyup(function(t){27==t.keyCode&&(e.isOpenCart=!1,C.isMobile&&(e.showbuynow=!0),$("body").removeClass("modal-open"),s.$$phase||s.$apply())}),document.onkeydown=function(t){if(e.isOpenCart)switch(t.keyCode){case 38:t.preventDefault();break;case 40:t.preventDefault()}},C.closeCart=function(){e.isOpenCart=!1,C.isMobile&&(e.showbuynow=!0),$("body").removeClass("modal-open")},C.clearCart=function(t){if(e.setLoader(!0),C.getCartInfoLocal(),C.cartDetail&&C.cartDetail.orderItems&&C.cartDetail.orderItems.length>0){for(var a=[],r=0;r<C.cartDetail.orderItems.length;r++)a.push(C.cartDetail.orderItems[r].id);var n=a.join();C.analyticsUtil.trackCartClearButton(n)}e.cartCount=0,e.isShowCart=!1,e.isOpenCart=!1,C.isMobile&&(e.showbuynow=!0);var t={cartId:C.customerInfo.cartId,customerId:C.customerInfo.customerId};i.deleteAllDeviceCart(t).then(function(t){e.setLoader(!1),o.removeFromLocalStorage("header","CartDetail"),localStorage.removeItem("homeCartCount"),o.removeFromCookie("homeCartCount"),o.setInCookie([{cname:"deviceCartId",cvalue:""},{cname:"deviceCustomerId",cvalue:""}])},function(t){e.setLoader(!1)}),$("body").removeClass("modal-open")},C.checkout=function(){if(C.getCartInfoLocal(),C.cartDetail&&C.cartDetail.orderItems&&C.cartDetail.orderItems.length>0){for(var t=[],r=0;r<C.cartDetail.orderItems.length;r++)t.push(C.cartDetail.orderItems[r].id);var n=t.join();C.analyticsUtil.trackPDPcheckoutClick(n)}var i=C.cartDetail;if(i&&i.orderItems.length>1){var c={templateUrl:"app/modules/buy/common/modals/cart.html",scope:s,size:"md"};l.show(c)}else e.isUserLoggedIn?o.goToSecurePath("main.app.devices.checkout.customerInfo",null,{reload:!0,inherit:!1,notify:!0}):a.go("main.app.devices.checkout.authenticate",null,{reload:!0,inherit:!1,notify:!0});e.cartDetail.orderItems.length>1?e.isOpenCart=!0:(e.setLoader(!0),e.isOpenCart=!1)},C.cancelRemoveModal=function(){l.hide()},C.removeProductLocal=function(t,a){if(C.getCartInfoLocal(),e.cartDetail||e.cartDetail.orderItems||e.cartDetail.orderItems.length){if(e.cartDetail.orderItems.splice(t,1),e.cartCount=e.cartDetail.orderItems.length,o.setInLocalStorage("header","CartDetail",e.cartDetail),isLocalStorageSupported.init()){var r=localStorage.getItem("homeCartCount");localStorage.setItem("homeCartCount",r-1)}else o.setInCookie([{cname:"homeCartCount",cvalue:r-1}]);0===e.cartCount&&($("body").removeClass("modal-open"),e.isOpenCart=!1,e.isShowCart=!1,C.isMobile&&(e.showbuynow=!0),o.removeFromLocalStorage("header","CartDetail"),localStorage.removeItem("homeCartCount"),o.removeFromCookie("homeCartCount"),o.setInCookie([{cname:"deviceCartId",cvalue:""},{cname:"deviceCustomerId",cvalue:""}]))}},C.removeProduct=function(t,a){C.getCartInfoLocal();var a={cartId:C.customerInfo.cartId,itemId:a.orderItemId,customerId:C.customerInfo.customerId};i.deleteDeviceCart(a).then(function(a){if(e.setLoader(!1,"overlayLoader"),e.cartDetail.orderItems.splice(t,1),e.cartCount=e.cartDetail.orderItems.length,o.setInLocalStorage("header","CartDetail",e.cartDetail),isLocalStorageSupported.init()){var r=localStorage.getItem("homeCartCount");localStorage.setItem("homeCartCount",r-1)}else o.setInCookie([{cname:"homeCartCount",cvalue:r-1}]);0===e.cartCount&&($("body").removeClass("modal-open"),e.isOpenCart=!1,e.isShowCart=!1,C.isMobile&&(e.showbuynow=!0),o.removeFromLocalStorage("header","CartDetail"),localStorage.removeItem("homeCartCount"),o.removeFromCookie("homeCartCount"),o.setInCookie([{cname:"deviceCartId",cvalue:""},{cname:"deviceCustomerId",cvalue:""}]))},function(t){e.setLoader(!1,"overlayLoader"),!t||"CART_ID_NOT_AVAILABLE"!=t.code&&"ITEM_ID_NOT_AVAILABLE"!=t.code&&"ITEMS_NOT_AVAILABLE"!=t.code?t&&t.data&&("CART_ID_NOT_AVAILABLE"==t.data.code||"ITEM_ID_NOT_AVAILABLE"==t.data.code||"ITEMS_NOT_AVAILABLE"==t.data.code)&&u():u()})},C.getCartInfoLocal=function(){e.cartCount=0,C.cartDetail=o.getFromLocalStorage("header","CartDetail"),C.customerId=o.getFromCookie("deviceCustomerId"),C.cartId=o.getFromCookie("deviceCartId"),C.customerInfo=o.getFromLocalStorage("device","CustomerInfo"),C.customerInfo||(C.customerInfo={cartId:C.cartId,customerId:C.customerId}),C.cartDetail||C.customerId?C.cartDetail&&C.cartDetail.orderItems&&C.cartDetail.orderItems.length>0&&(e.cartCount=C.cartDetail.orderItems.length,e.cartDetail=C.cartDetail):e.cartCount=0,e.cartCount>0&&(e.isShowCart=!0)},C.getCartInfo=function(){if(e.cartCount=0,C.cartDetail=o.getFromLocalStorage("header","CartDetail"),C.customerId=o.getFromCookie("deviceCustomerId"),C.cartId=o.getFromCookie("deviceCartId"),C.customerInfo=o.getFromLocalStorage("device","CustomerInfo"),C.customerInfo||(C.customerInfo={cartId:C.cartId,customerId:C.customerId}),C.cartDetail)C.cartDetail&&C.cartDetail.orderItems&&C.cartDetail.orderItems.length>0&&(e.cartCount=C.cartDetail.orderItems.length,e.cartDetail=C.cartDetail);else{if(!C.customerId)return void(e.cartCount=0);var t={customerId:C.customerId};i.fetchCartDetail(t).then(function(t){t.data.orderItems&&(C.cartDetail=t.data,o.setInLocalStorage("header","CartDetail",C.cartDetail),e.cartCount=C.cartDetail.orderItems.length,e.cartDetail=t.data,e.cartCount>0&&(e.isShowCart=!0))},function(t){e.setLoader(!1)})}e.cartCount>0&&(e.isShowCart=!0)},d(),e.$on("$viewContentLoaded",function(e){r(function(){boxLink.init(),footerBackToTop.init(),customNav.initMenu(),smallHeaderScroll.init(),loadAsyncImages.init(),scrollInView.init()},1e3)})}])}):(boxLink.init(),footerBackToTop.init(),customNav.initMenu(),smallHeaderScroll.init(),loadAsyncImages.init(),scrollInView.init(),loadCart.init());